<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <title>Éditeur de sondage</title>
    </head>
<body>

    <h1>Éditeur de sondage</h1>

    <div id="sections-container">

    </div>

    <button onclick="addSection()">+ Ajouter une section</button>
    <button onclick="saveQuestion()">✓ Sauvegarder</button>

    <script>

function renderEditor() {
    var container = document.getElementById("sections-container");
    container.innerHTML = "";

    data.sections.forEach(function(section, si) {
        var div = document.createElement("div");
        div.innerHTML =
            '<h2>' + section.title + '</h2>' +
            '<button onclick="deleteSection(' + si + ')">Supprimer la section</button>' +
            '<div id="questions-' + si + '">' +
                section.questions.map(function(q, qi) {
                    return '<p>' + q.label + ' <em>(' + q.type + ')</em> ' +
                        '<button onclick="deleteQuestion(' + si + ',' + qi + ')">✕</button></p>';
                }).join('') +
            '</div>' +
            '<button onclick="addQuestion(' + si + ')">+ Ajouter une question</button>';
        container.appendChild(div);
    });
}

function addQuestion(si) {

    data.section[si].questions.push({
        label: "Nouvelle question",
        type: "text"
    });
}

function deleteQuestion(si, qi) {

    data.sections[si].questions.splice(qi, 1)
    renderEditor()
}



async function loadQuestions() {
    var res = await fetch("/questions");
    var json = await res.json();
    if (json.sections) {
        data = json;
    }
    renderEditor();
}

async function saveQuestion() {
    var res = await fetch("/save-questions", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
    });
    var json = await res.json();
    if (json.status === "ok") {
        alert("Sauvegardé !");
    } else {
        alert("Erreur lors de la sauvegarde.");
    }
}

    loadQuestions();

    </script>

</body>
</html>